{"version":3,"file":"game-model.js","sources":["js/data/game-data.js","js/game/check-answers.js","js/data/game-model.js"],"sourcesContent":["export const GAME_SETTINGS = {\n  totalQuestions: 10,\n  totalTime: 300000, // 5 min in ms\n  fastAnswerTime: 30000, // 30 sec in ms\n  maxMistakes: 2,\n  losePoints: -1,\n  regularPoints: 1,\n  fastPoints: 2,\n  wrongPoints: -2\n};\n\nexport const GameStatus = {\n  TIMEUP: `timeup`,\n  LOSE: `lose`,\n  WIN: `win`,\n  CONTINUE: `continue`\n};\n\nexport const INITIAL_STATE = Object.freeze({\n  level: 0,\n  timeLeft: GAME_SETTINGS.totalTime,\n  mistakes: 0,\n  answers: []\n});\n","/**\n * Проверяет ответы пользователя\n * @param {Object} question Вопрос\n * @param {Array} answers Ответы пользователя\n * @return {Boolean} Возвращает true, если выбраны только верные ответы\n */\n\nconst checkAnswers = (question, answers) => {\n  const correctAnswers = [...Object.entries(question.answers)].reduce((arr, [answerValue, answerData]) => {\n    if (answerData.correct) {\n      arr.push(answerValue);\n    }\n    return arr;\n  }, []);\n\n  if (correctAnswers.length === answers.length) {\n    return correctAnswers.every((elem) => answers.includes(elem));\n  } else {\n    return false;\n  }\n};\n\nexport default checkAnswers;\n","import {GAME_SETTINGS, INITIAL_STATE, GameStatus} from \"./game-data\";\nimport checkAnswers from \"../game/check-answers\";\n\nclass GameModel {\n  constructor(data) {\n    this.data = data;\n    // Чтобы включить режим отладки, нужно добавить в url параметр ?debug=true\n    // Правильные ответы будут обозначены красным.\n    this.debug = new URLSearchParams(location.search).get(`debug`) || false;\n    this.restart();\n  }\n\n  get questions() {\n    return this.data.questions;\n  }\n\n  get audiosMap() {\n    return this.data.audiosMap;\n  }\n\n  get level() {\n    return this.state.level;\n  }\n\n  get timeLeft() {\n    return this.state.timeLeft;\n  }\n\n  get mistakes() {\n    return this.state.mistakes;\n  }\n\n  get currentQuestion() {\n    return this.questions[this.level];\n  }\n\n  get status() {\n    if (this.state.timeLeft === 0) {\n      return GameStatus.TIMEUP;\n    }\n\n    if (this.state.mistakes > GAME_SETTINGS.maxMistakes) {\n      return GameStatus.LOSE;\n    }\n\n    if (this.state.answers.length === GAME_SETTINGS.totalQuestions) {\n      return GameStatus.WIN;\n    }\n\n    return GameStatus.CONTINUE;\n  }\n\n  restart() {\n    this.state = Object.assign({}, INITIAL_STATE);\n    this.state.answers = []; // Удаляем ответы, оставшиеся с предыдущей игры\n  }\n\n  levelUp() {\n    this.state.level++;\n  }\n\n  saveAnswer(answer) {\n    const correct = checkAnswers(this.currentQuestion, answer);\n\n    if (!correct) {\n      this.state.mistakes++;\n    }\n\n    const time = GAME_SETTINGS.totalTime - this.timeLeft - this._calculateAnswersTime();\n    this.state.answers.push({time, correct});\n  }\n\n  tick(interval) {\n    if (this.timeLeft > 0) {\n      this.state.timeLeft -= interval;\n      return true;\n    }\n    return false;\n  }\n\n  _calculateAnswersTime() {\n    return this.state.answers.reduce((sum, answer) => {\n      sum += answer.time;\n      return sum;\n    }, 0);\n  }\n\n}\n\nexport default GameModel;\n"],"names":[],"mappings":"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"}