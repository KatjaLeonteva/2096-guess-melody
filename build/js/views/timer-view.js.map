{"version":3,"file":"timer-view.js","sources":["js/views/abstract-view.js","js/util.js","js/game/get-radius.js","js/views/timer-view.js"],"sourcesContent":["/**\n * Создает DOM-элемент по шаблону.\n * @param {string} markup Разметка элемента.\n * @return {Node} Новый элемент.\n */\nconst render = (markup = ``) => {\n  const template = document.createElement(`template`);\n  template.innerHTML = markup.trim();\n  return template.content.firstChild;\n};\n\nexport default class AbstractView {\n  constructor() {\n    if (new.target === AbstractView) {\n      throw new Error(`Can't instantiate AbstractView, only concrete one`);\n    }\n  }\n\n  get template() {\n    throw new Error(`Template is required`);\n  }\n\n  get element() {\n    if (this._element) {\n      return this._element;\n    }\n    this._element = this.render();\n    this.bind(this._element);\n    return this._element;\n  }\n\n  render() {\n    return render(this.template);\n  }\n\n  bind() {\n    // bind handlers if required\n  }\n\n}\n","// Варианты склонения для 1 шт, 2-4 шт, 0 и 5-20 шт\nconst cases = {\n  minutes: [`минуту`, `минуты`, `минут`],\n  seconds: [`секунду`, `секунды`, `секунд`],\n  points: [`балл`, `балла`, `баллов`],\n  mistakes: [`ошибку`, `ошибки`, `ошибок`],\n  attempts: [`раз`, `раза`, `раз`],\n  fast: [`быстрый`, `быстрых`, `быстрых`]\n};\n\nexport const TimeInMs = {\n  ONE_MINUTE: 60000,\n  ONE_SECOND: 1000\n};\n\n/**\n * Переводит миллисекунды в минуты и секунды\n * @param {number} ms Миллисекунды.\n * @return {object} Время в минутах и секундах\n */\nexport const msToMinutesAndSeconds = (ms) => {\n  const minutes = Math.floor(ms / TimeInMs.ONE_MINUTE);\n  const seconds = ((ms % TimeInMs.ONE_MINUTE) / TimeInMs.ONE_SECOND).toFixed(0);\n  return {minutes, seconds};\n};\n\n/**\n * Возвращает существительное в правильном склонении\n * в зависимости от стоящего перед ним числа\n * @param {number} number Число\n * @param {string} noun Существительное\n * @return {string} Существительное в правильном склонении\n */\nexport const pluralize = (number, noun) => {\n  const nouns = cases[noun];\n\n  let n = Math.abs(number);\n\n  // Ends in 1, excluding 11\n  if (n % 10 === 1 && n % 100 !== 11) {\n    return nouns[0];\n  }\n  // Ends in 2-4, excluding 12-14\n  if (n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20)) {\n    return nouns[1];\n  }\n\n  // Everything else\n  return nouns[2];\n};\n","const getRadius = (timeRatio, radius) => {\n  const stroke = (2 * Math.PI * radius).toFixed(); // Circumference of a circle is 2 * Pi * r\n  const offset = ((1 - timeRatio) * stroke).toFixed();\n\n  return {stroke, offset};\n};\n\nexport default getRadius;\n","import AbstractView from \"./abstract-view\";\nimport {msToMinutesAndSeconds} from \"../util\";\nimport getRadius from \"../game/get-radius\";\n\nconst RADIUS = 370;\nconst ALARM = 30000; // Когда осталось менее 30 секунд таймер должен начать мигать красным цветом\n\nexport default class TimerView extends AbstractView {\n  constructor(timeLeft, totalTime) {\n    super();\n    this.timeLeft = timeLeft;\n    this.totalTime = totalTime;\n  }\n\n  get template() {\n    const timerRadius = getRadius(this.timeLeft / this.totalTime, RADIUS);\n    const timeLeftInMinSec = msToMinutesAndSeconds(this.timeLeft);\n\n    return `<div>\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"timer\" viewBox=\"0 0 780 780\">\n        <circle\n          cx=\"390\" cy=\"390\" r=\"370\"\n          class=\"timer-line\"\n          stroke-dasharray=\"${timerRadius.stroke}\"\n          stroke-dashoffset=\"${timerRadius.offset}\"\n          style=\"filter: url(../#blur); transform: rotate(-90deg) scaleY(-1); transform-origin: center\"></circle>\n      </svg>\n      <div class=\"timer-value ${this.timeLeft < ALARM ? `timer-value--finished` : ``}\" xmlns=\"http://www.w3.org/1999/xhtml\">\n        <span class=\"timer-value-mins\">${timeLeftInMinSec.minutes.toString().padStart(2, `0`)}</span><!--\n        --><span class=\"timer-value-dots\">:</span><!--\n        --><span class=\"timer-value-secs\">${timeLeftInMinSec.seconds.toString().padStart(2, `0`)}</span>\n      </div>\n    </div>`;\n  }\n\n}\n"],"names":[],"mappings":";;;EAAA;EACA;EACA;EACA;EACA;EACA,MAAM,MAAM,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK;EAChC,EAAE,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;EACtD,EAAE,QAAQ,CAAC,SAAS,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;EACrC,EAAE,OAAO,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAC;EACrC,CAAC,CAAC;;AAEF,EAAe,MAAM,YAAY,CAAC;EAClC,EAAE,WAAW,GAAG;EAChB,IAAI,IAAI,GAAG,CAAC,MAAM,KAAK,YAAY,EAAE;EACrC,MAAM,MAAM,IAAI,KAAK,CAAC,CAAC,iDAAiD,CAAC,CAAC,CAAC;EAC3E,KAAK;EACL,GAAG;;EAEH,EAAE,IAAI,QAAQ,GAAG;EACjB,IAAI,MAAM,IAAI,KAAK,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC;EAC5C,GAAG;;EAEH,EAAE,IAAI,OAAO,GAAG;EAChB,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;EACvB,MAAM,OAAO,IAAI,CAAC,QAAQ,CAAC;EAC3B,KAAK;EACL,IAAI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;EAClC,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;EAC7B,IAAI,OAAO,IAAI,CAAC,QAAQ,CAAC;EACzB,GAAG;;EAEH,EAAE,MAAM,GAAG;EACX,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;EACjC,GAAG;;EAEH,EAAE,IAAI,GAAG;EACT;EACA,GAAG;;EAEH,CAAC;;ECvCD;AACA,AAQA;AACA,EAAO,MAAM,QAAQ,GAAG;EACxB,EAAE,UAAU,EAAE,KAAK;EACnB,EAAE,UAAU,EAAE,IAAI;EAClB,CAAC,CAAC;;EAEF;EACA;EACA;EACA;EACA;AACA,EAAO,MAAM,qBAAqB,GAAG,CAAC,EAAE,KAAK;EAC7C,EAAE,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,QAAQ,CAAC,UAAU,CAAC,CAAC;EACvD,EAAE,MAAM,OAAO,GAAG,CAAC,CAAC,EAAE,GAAG,QAAQ,CAAC,UAAU,IAAI,QAAQ,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;EAChF,EAAE,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;EAC5B,CAAC,CAAC;;ECxBF,MAAM,SAAS,GAAG,CAAC,SAAS,EAAE,MAAM,KAAK;EACzC,EAAE,MAAM,MAAM,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE,OAAO,EAAE,CAAC;EAClD,EAAE,MAAM,MAAM,GAAG,CAAC,CAAC,CAAC,GAAG,SAAS,IAAI,MAAM,EAAE,OAAO,EAAE,CAAC;;EAEtD,EAAE,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;EAC1B,CAAC,CAAC;;ECDF,MAAM,MAAM,GAAG,GAAG,CAAC;EACnB,MAAM,KAAK,GAAG,KAAK,CAAC;;AAEpB,EAAe,MAAM,SAAS,SAAS,YAAY,CAAC;EACpD,EAAE,WAAW,CAAC,QAAQ,EAAE,SAAS,EAAE;EACnC,IAAI,KAAK,EAAE,CAAC;EACZ,IAAI,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;EAC7B,IAAI,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;EAC/B,GAAG;;EAEH,EAAE,IAAI,QAAQ,GAAG;EACjB,IAAI,MAAM,WAAW,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;EAC1E,IAAI,MAAM,gBAAgB,GAAG,qBAAqB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;;EAElE,IAAI,OAAO,CAAC;;;;;4BAKgB,EAAE,WAAW,CAAC,MAAM,CAAC;6BACpB,EAAE,WAAW,CAAC,MAAM,CAAC;;;8BAGpB,EAAE,IAAI,CAAC,QAAQ,GAAG,KAAK,GAAG,CAAC,qBAAqB,CAAC,GAAG,CAAC,CAAC,CAAC;uCAC9C,EAAE,gBAAgB,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;;0CAEpD,EAAE,gBAAgB,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;;UAEvF,CAAC,CAAC;EACZ,GAAG;;EAEH,CAAC;;;;;;;;"}