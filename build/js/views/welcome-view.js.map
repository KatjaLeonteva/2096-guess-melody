{"version":3,"file":"welcome-view.js","sources":["js/views/abstract-view.js","js/util.js","js/views/welcome-view.js"],"sourcesContent":["/**\n * Создает DOM-элемент по шаблону.\n * @param {string} markup Разметка элемента.\n * @return {Node} Новый элемент.\n */\nconst render = (markup = ``) => {\n  const template = document.createElement(`template`);\n  template.innerHTML = markup.trim();\n  return template.content.firstChild;\n};\n\nexport default class AbstractView {\n  constructor() {\n    if (new.target === AbstractView) {\n      throw new Error(`Can't instantiate AbstractView, only concrete one`);\n    }\n  }\n\n  get template() {\n    throw new Error(`Template is required`);\n  }\n\n  get element() {\n    if (this._element) {\n      return this._element;\n    }\n    this._element = this.render();\n    this.bind(this._element);\n    return this._element;\n  }\n\n  render() {\n    return render(this.template);\n  }\n\n  bind() {\n    // bind handlers if required\n  }\n\n}\n","// Варианты склонения для 1 шт, 2-4 шт, 0 и 5-20 шт\nconst cases = {\n  minutes: [`минуту`, `минуты`, `минут`],\n  seconds: [`секунду`, `секунды`, `секунд`],\n  points: [`балл`, `балла`, `баллов`],\n  mistakes: [`ошибку`, `ошибки`, `ошибок`],\n  attempts: [`раз`, `раза`, `раз`],\n  fast: [`быстрый`, `быстрых`, `быстрых`]\n};\n\nexport const TimeInMs = {\n  ONE_MINUTE: 60000,\n  ONE_SECOND: 1000\n};\n\n/**\n * Переводит миллисекунды в минуты и секунды\n * @param {number} ms Миллисекунды.\n * @return {object} Время в минутах и секундах\n */\nexport const msToMinutesAndSeconds = (ms) => {\n  const minutes = Math.floor(ms / TimeInMs.ONE_MINUTE);\n  const seconds = ((ms % TimeInMs.ONE_MINUTE) / TimeInMs.ONE_SECOND).toFixed(0);\n  return {minutes, seconds};\n};\n\n/**\n * Возвращает существительное в правильном склонении\n * в зависимости от стоящего перед ним числа\n * @param {number} number Число\n * @param {string} noun Существительное\n * @return {string} Существительное в правильном склонении\n */\nexport const pluralize = (number, noun) => {\n  const nouns = cases[noun];\n\n  let n = Math.abs(number);\n\n  // Ends in 1, excluding 11\n  if (n % 10 === 1 && n % 100 !== 11) {\n    return nouns[0];\n  }\n  // Ends in 2-4, excluding 12-14\n  if (n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20)) {\n    return nouns[1];\n  }\n\n  // Everything else\n  return nouns[2];\n};\n","import AbstractView from \"./abstract-view\";\nimport {msToMinutesAndSeconds, pluralize} from \"../util\";\n\nconst LoaderText = {\n  PROGRESS: `Игра загружается...`,\n  FAIL: `Загрузить еще раз`\n};\n\nexport default class WelcomeView extends AbstractView {\n  constructor(settings, callback) {\n    super();\n    this.settings = settings;\n    this.callback = callback;\n  }\n\n  get template() {\n    const totalTimeMin = msToMinutesAndSeconds(this.settings.totalTime).minutes;\n    const maxMistakes = this.settings.maxMistakes;\n\n    return `<section class=\"main main--welcome\">\n      <section class=\"logo\" title=\"Угадай мелодию\"><h1>Угадай мелодию</h1></section>\n      <p class=\"text loader\">${LoaderText.PROGRESS}</p>\n      <button class=\"main-play main-play--hidden\">Начать игру</button>\n      <h2 class=\"title main-title\">Правила игры</h2>\n      <p class=\"text main-text\">\n        Правила просты&nbsp;— за&nbsp;${totalTimeMin} ${pluralize(totalTimeMin, `minutes`)} ответить на все вопросы.<br>\n        Ошибиться можно ${maxMistakes} ${pluralize(maxMistakes, `attempts`)}.<br>\n        Удачи!\n      </p>\n    </section>`;\n  }\n\n  onPlayButtonClick() {}\n\n  onLoadSuccess() {\n    this.element.querySelector(`.main-play`).classList.remove(`main-play--hidden`);\n    this.element.querySelector(`.loader`).remove();\n  }\n\n  onLoadFail() {\n    const loader = this.element.querySelector(`.loader`);\n\n    const onLoaderClick = () => {\n      loader.textContent = LoaderText.PROGRESS;\n      loader.classList.remove(`loader--failed`);\n      this.callback();\n      loader.removeEventListener(`click`, onLoaderClick);\n    };\n\n    // Если данные не загрузились, попробовать еще раз\n    loader.textContent = LoaderText.FAIL;\n    loader.classList.add(`loader--failed`);\n    loader.addEventListener(`click`, onLoaderClick);\n  }\n\n  bind() {\n    const playButton = this.element.querySelector(`.main-play`);\n    playButton.addEventListener(`click`, () => this.onPlayButtonClick());\n  }\n}\n"],"names":[],"mappings":"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"}