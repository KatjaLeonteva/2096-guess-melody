{"version":3,"file":"genre-view.js","sources":["js/views/abstract-view.js","js/views/player-view.js","js/views/genre-view.js"],"sourcesContent":["/**\n * Создает DOM-элемент по шаблону.\n * @param {string} markup Разметка элемента.\n * @return {Node} Новый элемент.\n */\nconst render = (markup = ``) => {\n  const template = document.createElement(`template`);\n  template.innerHTML = markup.trim();\n  return template.content.firstChild;\n};\n\nexport default class AbstractView {\n  constructor() {\n    if (new.target === AbstractView) {\n      throw new Error(`Can't instantiate AbstractView, only concrete one`);\n    }\n  }\n\n  get template() {\n    throw new Error(`Template is required`);\n  }\n\n  get element() {\n    if (this._element) {\n      return this._element;\n    }\n    this._element = this.render();\n    this.bind(this._element);\n    return this._element;\n  }\n\n  render() {\n    return render(this.template);\n  }\n\n  bind() {\n    // bind handlers if required\n  }\n\n}\n","import AbstractView from \"./abstract-view\";\n\nexport default class PlayerView extends AbstractView {\n  constructor(audio, autoplay) {\n    super();\n    this.audio = audio;\n    this.autoplay = autoplay;\n\n    this.audio.autoplay = this.autoplay;\n    const player = this.element.querySelector(`.player`);\n    player.insertBefore(this.audio, player.firstElementChild);\n  }\n\n  get template() {\n    return `<div class=\"player-wrapper\">\n    <div class=\"player\">\n      <button class=\"player-control player-control--${this.autoplay ? `pause` : `play`}\"></button>\n      <div class=\"player-track\">\n        <span class=\"player-status\"></span>\n      </div>\n    </div>\n  </div>`;\n  }\n\n  onPlayClicked() {}\n\n  bind() {\n    const player = this.element.querySelector(`.player`);\n    player.addEventListener(`click`, (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      if (this.isPlaying()) {\n        this.pauseTrack();\n      } else {\n        this.playTrack();\n      }\n    });\n  }\n\n  pauseTrack() {\n    this.element.querySelector(`audio`).pause();\n    this.element.querySelector(`.player-control`).classList.replace(`player-control--pause`, `player-control--play`);\n  }\n\n  playTrack() {\n    this.onPlayClicked();\n    this.element.querySelector(`audio`).play().catch((error) => {\n      throw new Error(error); // An error ocurred or the user agent prevented playback.\n    });\n    this.element.querySelector(`.player-control`).classList.replace(`player-control--play`, `player-control--pause`);\n  }\n\n  stopTrack() {\n    this.pauseTrack();\n    this.element.querySelector(`audio`).currentTime = 0;\n  }\n\n  isPlaying() {\n    const audio = this.element.querySelector(`audio`);\n    return audio.duration > 0 && !audio.paused;\n  }\n\n}\n","import AbstractView from \"./abstract-view\";\nimport PlayerView from \"./player-view\";\n\nexport default class GenreView extends AbstractView {\n  constructor(model) {\n    super();\n    this.model = model;\n    this.question = this.model.currentQuestion;\n    this.players = [];\n\n    const placeholders = this.element.querySelectorAll(`.player`);\n    placeholders.forEach((placeholder, index) => {\n      const player = new PlayerView(this.model.audiosMap.get(this.question.answers[placeholder.id].track.src), index === 0);\n      player.onPlayClicked = () => this.pauseAllTracks();\n      this.players.push(player);\n      placeholder.parentElement.replaceChild(player.element, placeholder);\n    });\n  }\n\n  get template() {\n    return `<section class=\"main main--level main--level-genre\">\n    <div class=\"main-wrap\">\n      <h2 class=\"title\">${this.question.title}</h2>\n      <form class=\"genre\">\n        ${[...Object.entries(this.question.answers)].map(([answerValue, answerData], index) => `\n        <div class=\"genre-answer\">\n          <div class=\"player\" id=\"${answerValue}\"></div>\n          <input type=\"checkbox\" name=\"answer\" value=\"${answerValue}\" id=\"a-${index + 1}\">\n          <label class=\"genre-answer-check ${this.model.debug && answerData.correct ? `genre-answer-check--correct` : ``}\" for=\"a-${index + 1}\"></label>\n        </div>`).join(``)}\n        <button class=\"genre-answer-send\" type=\"submit\">Ответить</button>\n      </form>\n    </div>\n  </section>`;\n  }\n\n  onAnswerSend() {}\n\n  bind() {\n    // Обработчик для формы\n    const genreForm = this.element.querySelector(`form.genre`);\n    const genreAnswers = Array.from(genreForm.querySelectorAll(`input[name=\"answer\"]`));\n    const sendAnswerButton = genreForm.querySelector(`.genre-answer-send`);\n\n    const onAnswerChange = () => {\n      const someAnswersChecked = genreAnswers.some((el) => el.checked === true);\n      sendAnswerButton.disabled = !someAnswersChecked;\n    };\n\n    sendAnswerButton.disabled = true; // Кнопка «Ответить» отключена, пока не выбран ни один из вариантов ответа.\n\n    genreAnswers.forEach((answer) => {\n      answer.addEventListener(`change`, onAnswerChange);\n    });\n\n    sendAnswerButton.addEventListener(`click`, (evt) => {\n      evt.preventDefault();\n      const checkedAnswers = genreAnswers.filter((input) => input.checked).map((input) => input.value);\n      this.onAnswerSend(checkedAnswers);\n    });\n  }\n\n  pauseAllTracks() {\n    this.players.map((it) => it.pauseTrack());\n  }\n\n  stopAllTracks() {\n    this.players.map((it) => it.stopTrack());\n  }\n\n}\n"],"names":[],"mappings":"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"}